import{S as R,i as U,s as W,F as G,c as M,m as S,t as E,a as O,d as j,r as H,g as J,p as z,b as Q,e as D,f as w,h as $,j as f,k as T,l as m,n as P,o as B,q as V,u as _,v as X,w as Y,x as Z,y as K,z as F,A as x}from"./index-BwJQrjaL.js";function ee(i){let t,u,r,n,e,p,c,d;return{c(){t=w("label"),u=K("Email"),n=$(),e=w("input"),f(t,"for",r=i[18]),f(e,"type","email"),f(e,"autocomplete","off"),f(e,"id",p=i[18]),e.disabled=i[6],e.required=!0,e.autofocus=!0},m(o,a){m(o,t,a),P(t,u),m(o,n,a),m(o,e,a),F(e,i[2]),e.focus(),c||(d=B(e,"input",i[10]),c=!0)},p(o,a){a&262144&&r!==(r=o[18])&&f(t,"for",r),a&262144&&p!==(p=o[18])&&f(e,"id",p),a&64&&(e.disabled=o[6]),a&4&&e.value!==o[2]&&F(e,o[2])},d(o){o&&(_(t),_(n),_(e)),c=!1,d()}}}function te(i){let t,u,r,n,e,p,c,d,o,a;return{c(){t=w("label"),u=K("Password"),n=$(),e=w("input"),c=$(),d=w("div"),d.textContent="Recommended at least 10 characters.",f(t,"for",r=i[18]),f(e,"type","password"),f(e,"autocomplete","new-password"),f(e,"minlength","10"),f(e,"id",p=i[18]),e.disabled=i[6],e.required=!0,f(d,"class","help-block")},m(b,h){m(b,t,h),P(t,u),m(b,n,h),m(b,e,h),F(e,i[3]),m(b,c,h),m(b,d,h),o||(a=B(e,"input",i[11]),o=!0)},p(b,h){h&262144&&r!==(r=b[18])&&f(t,"for",r),h&262144&&p!==(p=b[18])&&f(e,"id",p),h&64&&(e.disabled=b[6]),h&8&&e.value!==b[3]&&F(e,b[3])},d(b){b&&(_(t),_(n),_(e),_(c),_(d)),o=!1,a()}}}function ne(i){let t,u,r,n,e,p,c,d;return{c(){t=w("label"),u=K("Password confirm"),n=$(),e=w("input"),f(t,"for",r=i[18]),f(e,"type","password"),f(e,"minlength","10"),f(e,"id",p=i[18]),e.disabled=i[6],e.required=!0},m(o,a){m(o,t,a),P(t,u),m(o,n,a),m(o,e,a),F(e,i[4]),c||(d=B(e,"input",i[12]),c=!0)},p(o,a){a&262144&&r!==(r=o[18])&&f(t,"for",r),a&262144&&p!==(p=o[18])&&f(e,"id",p),a&64&&(e.disabled=o[6]),a&16&&e.value!==o[4]&&F(e,o[4])},d(o){o&&(_(t),_(n),_(e)),c=!1,d()}}}function le(i){let t,u,r,n,e,p,c,d,o,a,b,h,C,g,A,k,v,I,L;return n=new D({props:{class:"form-field required",name:"email",$$slots:{default:[ee,({uniqueId:s})=>({18:s}),({uniqueId:s})=>s?262144:0]},$$scope:{ctx:i}}}),p=new D({props:{class:"form-field required",name:"password",$$slots:{default:[te,({uniqueId:s})=>({18:s}),({uniqueId:s})=>s?262144:0]},$$scope:{ctx:i}}}),d=new D({props:{class:"form-field required",name:"passwordConfirm",$$slots:{default:[ne,({uniqueId:s})=>({18:s}),({uniqueId:s})=>s?262144:0]},$$scope:{ctx:i}}}),{c(){t=w("form"),u=w("div"),u.innerHTML="<h4>Create your first superuser account in order to continue</h4>",r=$(),M(n.$$.fragment),e=$(),M(p.$$.fragment),c=$(),M(d.$$.fragment),o=$(),a=w("button"),a.innerHTML='<span class="txt">Create superuser and login</span> <i class="ri-arrow-right-line"></i>',b=$(),h=w("hr"),C=$(),g=w("label"),g.innerHTML='<i class="ri-upload-cloud-line"></i> <span class="txt">Or initialize from backup</span>',A=$(),k=w("input"),f(u,"class","content txt-center m-b-base"),f(a,"type","submit"),f(a,"class","btn btn-lg btn-block btn-next"),T(a,"btn-disabled",i[6]),T(a,"btn-loading",i[0]),f(t,"class","block"),f(t,"autocomplete","off"),f(g,"for","backupFileInput"),f(g,"class","btn btn-lg btn-hint btn-transparent btn-block"),T(g,"btn-disabled",i[6]),T(g,"btn-loading",i[1]),f(k,"id","backupFileInput"),f(k,"type","file"),f(k,"class","hidden"),f(k,"accept",".zip")},m(s,l){m(s,t,l),P(t,u),P(t,r),S(n,t,null),P(t,e),S(p,t,null),P(t,c),S(d,t,null),P(t,o),P(t,a),m(s,b,l),m(s,h,l),m(s,C,l),m(s,g,l),m(s,A,l),m(s,k,l),i[13](k),v=!0,I||(L=[B(t,"submit",V(i[7])),B(k,"change",i[14])],I=!0)},p(s,l){const q={};l&786500&&(q.$$scope={dirty:l,ctx:s}),n.$set(q);const y={};l&786504&&(y.$$scope={dirty:l,ctx:s}),p.$set(y);const N={};l&786512&&(N.$$scope={dirty:l,ctx:s}),d.$set(N),(!v||l&64)&&T(a,"btn-disabled",s[6]),(!v||l&1)&&T(a,"btn-loading",s[0]),(!v||l&64)&&T(g,"btn-disabled",s[6]),(!v||l&2)&&T(g,"btn-loading",s[1])},i(s){v||(E(n.$$.fragment,s),E(p.$$.fragment,s),E(d.$$.fragment,s),v=!0)},o(s){O(n.$$.fragment,s),O(p.$$.fragment,s),O(d.$$.fragment,s),v=!1},d(s){s&&(_(t),_(b),_(h),_(C),_(g),_(A),_(k)),j(n),j(p),j(d),i[13](null),I=!1,X(L)}}}function se(i){let t,u;return t=new G({props:{$$slots:{default:[le]},$$scope:{ctx:i}}}),{c(){M(t.$$.fragment)},m(r,n){S(t,r,n),u=!0},p(r,[n]){const e={};n&524415&&(e.$$scope={dirty:n,ctx:r}),t.$set(e)},i(r){u||(E(t.$$.fragment,r),u=!0)},o(r){O(t.$$.fragment,r),u=!1},d(r){j(t,r)}}}function ae(i,t,u){let r,{params:n}=t,e="",p="",c="",d=!1,o=!1,a;b();async function b(){if(!(n!=null&&n.token))return H("/");u(0,d=!0);try{const l=J(n==null?void 0:n.token);await z.collection("_superusers").getOne(l.id,{requestKey:"installer_token_check",headers:{Authorization:n==null?void 0:n.token}})}catch(l){l!=null&&l.isAbort||(Q("The installer token is invalid or has expired."),H("/"))}u(0,d=!1)}async function h(){if(!r){u(0,d=!0);try{await z.collection("_superusers").create({email:e,password:p,passwordConfirm:c},{headers:{Authorization:n==null?void 0:n.token}}),await z.collection("_superusers").authWithPassword(e,p),H("/")}catch(l){z.error(l)}u(0,d=!1)}}function C(){a&&u(5,a.value="",a)}function g(l){l&&Y(`Note that we don't perform validations for the uploaded backup files. Proceed with caution and only if you trust the file source.

Do you really want to upload and initialize "${l.name}"?`,()=>{A(l)},()=>{C()})}async function A(l){if(!(!l||r)){u(1,o=!0);try{await z.backups.upload({file:l},{headers:{Authorization:n==null?void 0:n.token}}),await z.backups.restore(l.name,{headers:{Authorization:n==null?void 0:n.token}}),x("Please wait while extracting the uploaded archive!"),await new Promise(q=>setTimeout(q,2e3)),H("/")}catch(q){z.error(q)}C(),u(1,o=!1)}}function k(){e=this.value,u(2,e)}function v(){p=this.value,u(3,p)}function I(){c=this.value,u(4,c)}function L(l){Z[l?"unshift":"push"](()=>{a=l,u(5,a)})}const s=l=>{var q,y;g((y=(q=l.target)==null?void 0:q.files)==null?void 0:y[0])};return i.$$set=l=>{"params"in l&&u(9,n=l.params)},i.$$.update=()=>{i.$$.dirty&3&&u(6,r=d||o)},[d,o,e,p,c,a,r,h,g,n,k,v,I,L,s]}class oe extends R{constructor(t){super(),U(this,t,ae,se,W,{params:9})}}export{oe as default};
